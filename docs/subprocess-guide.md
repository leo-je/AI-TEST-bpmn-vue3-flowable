# å®ç°BPMNå¤šå±‚æµç¨‹è®¾è®¡å™¨ï¼šè·¯å¾„å¯¼èˆªæ  + è¿”å›æŒ‰é’®åŠŸèƒ½
## ğŸ¯ æ•´ä½“ç›®æ ‡
å®ç°ä¸€ä¸ªæ”¯æŒ å­æµç¨‹åµŒå¥—å¯¼èˆª çš„ BPMN æµç¨‹è®¾è®¡å™¨ï¼ŒåŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ ¸å¿ƒ UI åŠŸèƒ½ï¼š

é¡¶éƒ¨æµç¨‹è·¯å¾„å¯¼èˆªæ ï¼ˆBreadcrumbï¼‰ï¼šæ‚¬æµ®ä¸é¡µé¢å·¦ä¸Šè§’ï¼ˆleftï¼š56pxï¼Œtopï¼š10pxï¼‰
å·¦ä¸Šè§’â€œè¿”å›ä¸Šä¸€çº§â€æ‚¬æµ®æŒ‰é’®ï¼šæ‚¬æµ®ä¸é¡µé¢å·¦ä¸Šè§’ï¼ˆleftï¼š10pxï¼Œtoï¼š10pxï¼‰
ä¸¤è€…ååŒå·¥ä½œï¼Œæä¾›ç›´è§‚çš„å¤šå±‚çº§æµç¨‹è®¾è®¡ä½“éªŒã€‚

## ğŸ“Œ åŠŸèƒ½éœ€æ±‚è¯¦è¿°
### ä¸€ã€æµç¨‹è·¯å¾„å¯¼èˆªæ ï¼ˆBreadcrumbï¼‰
#### æ˜¾ç¤ºè§„åˆ™:
- é¡¶éƒ¨æµç¨‹è·¯å¾„å¯¼èˆªæ ï¼ˆBreadcrumbï¼‰ï¼šæ‚¬æµ®ä¸é¡µé¢å·¦ä¸Šè§’ï¼ˆleftï¼š56pxï¼Œtopï¼š10pxï¼‰
- é»˜è®¤æ˜¾ç¤ºå½“å‰ä¸»æµç¨‹åç§°ï¼ˆä» bpmn:process çš„ name è·å–ï¼‰
- å½“ç”¨æˆ·é€šè¿‡ ç‚¹å‡»sub-process(collapsed)å’ŒAd-hoc sub-process(collapsed)çš„"open å­æµç¨‹id"æŒ‰é’®å±•å¼€è¿›å…¥å­æµç¨‹ bpmn:SubProcessçš„è®¾è®¡ç•Œé¢æ—¶ï¼Œè‡ªåŠ¨è¿½åŠ å­æµç¨‹åç§°
- è·¯å¾„æ ¼å¼ï¼šä¸»æµç¨‹ > å­æµç¨‹1 > å­æµç¨‹2

#### äº¤äº’è¡Œä¸º
- ç‚¹å‡»è·¯å¾„ä¸­çš„ä»»æ„æµç¨‹é¡¹ â†’ è·³è½¬å›è¯¥å±‚çº§
- ä½¿ç”¨å“åº”å¼æ ˆ pathStack: Ref<ProcessPathItem[]> ç®¡ç†è·¯å¾„
- ç‚¹å‡»sub-process(collapsed)å’ŒAd-hoc sub-process(collapsed) çš„ã€open  å­æµç¨‹idã€‘æŒ‰é’®è¿›å…¥å­æµç¨‹

### äºŒã€â€œè¿”å›ä¸Šä¸€çº§â€æ‚¬æµ®æŒ‰é’®
#### æ˜¾ç¤ºè§„åˆ™
- ä»…å½“ pathStack.length > 1 æ—¶æ˜¾ç¤º
- å›ºå®šå®šä½åœ¨é¡µé¢å·¦ä¸Šè§’ï¼ˆleftï¼š10pxï¼Œtopï¼š10pxï¼‰
#### äº¤äº’è¡Œä¸º
- ç‚¹å‡»æŒ‰é’® â†’ è·³è½¬å› pathStack[pathStack.length - 2]
#### æ ·å¼è¦æ±‚
```css
.bpmn-return-button {
  position: absolute;
  left: 10px;
  top: 10px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: rgba(0, 0, 0, 0.6);
  color: white;
  border: none;
  z-index: 999;
```

## ğŸ§© ä¾èµ–ä¸Šä¸‹æ–‡ï¼ˆå·²æœ‰åŸºç¡€ï¼‰
é¡¹ç›®ä½¿ç”¨ Vue 3ï¼ˆComposition API + <script setup>ï¼‰ + TypeScript
å·²é›†æˆ bpmn.js v18ï¼ˆBpmnJS ç±»å‹å¯ç”¨ï¼‰
ä¸»æµç¨‹ XML å·²åŠ è½½ï¼ŒbpmnModeler å®ä¾‹å·²åˆ›å»º
å­æµç¨‹åœ¨ BPMN XML ä¸­ä»¥æ ‡å‡† <bpmn:subProcess> å½¢å¼å­˜åœ¨
æµç¨‹è®¾è®¡å…¥å£é¡µé¢src/App.tsx
### ğŸ“¦ æŠ€æœ¯è¦æ±‚
æ‰€æœ‰é€»è¾‘å°è£…åœ¨ å¯ç»„åˆå‡½æ•° useProcessBreadcrumb() ä¸­
ç±»å‹å®‰å…¨ï¼Œé¿å… anyï¼ˆä½¿ç”¨ bpmnModeler?.get(...) å®‰å…¨è°ƒç”¨ï¼‰
å¯ä½¿ç”¨ UI åº“ï¼ˆå¦‚ Element Plusï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸç”Ÿ HTML + CSS
#### è·¯å¾„æ ˆæ•°æ®ç»“æ„
```ts
interface ProcessPathItem {
  id: string;
  name?: string;        // ä¼˜å…ˆæ˜¾ç¤º nameï¼Œå¦åˆ™æ˜¾ç¤º id
  element: any;         // bpmn.js element å¯¹è±¡ï¼ˆå« businessObjectï¼‰
}
```

### ğŸ“ æ¨èæ–‡ä»¶ç»“æ„
```sh
src/
â”œâ”€â”€ components-/
â”‚   â””â”€â”€ bpmn-breadcrumb/
â”‚       â”œâ”€â”€ useProcessBreadcrumb.ts  # è·¯å¾„å¯¼èˆªé€»è¾‘
â”‚       â”œâ”€â”€ BpmnBreadcrumb.tsx       # è·¯å¾„å¯¼èˆªæ ç»„ä»¶
â”‚       â””â”€â”€ BpmnReturnButton.tsx     # è¿”å›æŒ‰é’®ç»„ä»¶
```

###ğŸš« ç¦æ­¢è¡Œä¸º
âŒ ä¸è¦è‡ªå®šä¹‰ contextPadProvider contextPad
âŒ ä¸è¦ä¿®æ”¹ BPMN XML ç»“æ„ï¼ˆå¦‚æ·»åŠ  innerProcessï¼‰
âŒ ä¸è¦é‡å¤å®ç°å­æµç¨‹å±•å¼€é€»è¾‘

### ğŸ§ª äº¤äº’æµç¨‹ç¤ºä¾‹
- åˆå§‹çŠ¶æ€:è·¯å¾„ï¼šä¸»æµç¨‹åç§°,è¿”å›æŒ‰é’®ï¼šéšè—
- ç‚¹å‡»å­æµç¨‹â€œopen å­æµç¨‹idâ€æŒ‰é’®,è·¯å¾„å˜ä¸ºï¼šä¸»æµç¨‹åç§° > å­æµç¨‹åç§°...,è¿”å›æŒ‰é’®ï¼šæ˜¾ç¤º
- ç‚¹å‡»â€œè¿”å›â€æŒ‰é’® æˆ– ç‚¹å‡»â€œæµç¨‹åç§°â€ï¼Œè·¯å¾„æ›´æ–°